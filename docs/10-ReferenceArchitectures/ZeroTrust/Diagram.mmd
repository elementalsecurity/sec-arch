%%{init: {'theme': 'default'}}%%
flowchart TB
    subgraph Internet
        UserClient[User Client]
    end
    subgraph IdentityZone
        AuthBroker[Authn/Authz Broker]
    end
    subgraph WorkloadZone
        APIGateway[API Gateway]
        ServiceA[Service A]
        ServiceB[Service B]
    end
    subgraph DataZone
        KMS[KMS / HSM]
        Database[(Encrypted Database)]
    end

    UserClient -->|mTLS / JWT| APIGateway
    APIGateway -->|Validate Token| AuthBroker
    APIGateway --> ServiceA
    ServiceA --> ServiceB
    ServiceA -->|Request DEK| KMS
    ServiceB -->|Request DEK| KMS
    Database -.->|Encrypted at rest| KMS
